<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrueSignal - 19 Aralık 2025 Raporu</title>
    
    <!-- CSS Dosyaları -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Inline CSS for critical styles -->
    <style>
        /* Critical styles that need to work immediately */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #374151;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header styles */
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 2rem;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        header h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 1.2rem;
            position: relative;
            z-index: 1;
            margin-top: 0.5rem;
        }
        
        /* Navigation styles */
        nav {
            background: white;
            border-radius: 12px;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 10px;
            z-index: 100;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 0;
            margin: 0;
        }
        
        nav ul li a {
            text-decoration: none;
            color: #667eea;
            padding: 12px 24px;
            border-radius: 50px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            border: 2px solid transparent;
        }
        
        nav ul li a:hover,
        nav ul li a.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Main content */
        main {
            flex: 1;
            background: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        /* Tarih sayfası özel stilleri */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .positive { color: #38a169; }
        .negative { color: #e53e3e; }
        .info { color: #3182ce; }
        
        /* Tablo kontrolleri */
        .table-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .filter-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        /* Loading spinner */
        .loading {
            text-align: center;
            padding: 40px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }
        
        /* Error message */
        .error-message {
            text-align: center;
            padding: 40px;
            background: #fee;
            border-radius: 10px;
            color: #dc3545;
            margin: 20px 0;
        }
        
        /* Responsive fixes */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 1.5rem;
            }
            
            header h1 {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            nav ul {
                flex-direction: column;
                align-items: stretch;
            }
            
            nav ul li a {
                justify-content: center;
            }
            
            main {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .table-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-controls {
                flex-direction: column;
            }
            
            .filter-controls select,
            .filter-controls input {
                max-width: 100% !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <header>
            <h1><i class="fas fa-signal"></i> TrueSignal Emir Takip</h1>
            <p class="subtitle">19 Aralık 2025 - Günlük Performans Raporu</p>
        </header>
        
        <!-- NAVIGATION MENÜ -->
        <nav>
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i> Ana Sayfa</a></li>
                <li><a href="about.html"><i class="fas fa-info-circle"></i> Hakkında</a></li>
                <li><a href="contact.html"><i class="fas fa-envelope"></i> İletişim</a></li>
                <li><a href="404.html" title="404 Sayfasını Test Et"><i class="fas fa-exclamation-triangle"></i> 404 Test</a></li>
                <li><a href="2025-12-19.html" class="active"><i class="fas fa-calendar-day"></i> 19 Aralık 2025</a></li>
            </ul>
        </nav>
        
        <main class="main-content">
            <!-- Hero Section -->
            <div class="hero-section">
                <div class="hero-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h2>19 Aralık 2025 Günlük Raporu</h2>
                <p>Bu tarihe ait gerçek zamanlı emir performans analizi ve istatistikler</p>
                <div class="data-source">
                    <i class="fas fa-database"></i>
                    <strong>Rapor Tarihi:</strong> 19 Aralık 2025, Cuma
                </div>
            </div>
            
            <!-- Emirler Tablosu Bölümü -->
            <div class="table-section">
                <h2 class="table-title"><i class="fas fa-table"></i> 19 Aralık 2025 Emirleri</h2>
                
                <div class="alert alert-primary">
                    <i class="fas fa-calendar-alt"></i>
                    <strong>Tarih:</strong> 19 Aralık 2025, Cuma - Gerçek Zamanlı Emir Takibi
                </div>
                
                <!-- İstatistik Kartları -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h5><i class="fas fa-list-ol"></i> Toplam Emir</h5>
                        <div class="stat-value info" id="totalOrders">0</div>
                        <p id="openClosedInfo">Yükleniyor...</p>
                    </div>
                    
                    <div class="stat-card">
                        <h5><i class="fas fa-coins"></i> Toplam Kar/Zarar</h5>
                        <div class="stat-value positive" id="totalProfitLoss">$0.00</div>
                        <p>Net Performans</p>
                    </div>
                    
                    <div class="stat-card">
                        <h5><i class="fas fa-percentage"></i> Başarı Oranı</h5>
                        <div class="stat-value info" id="successRate">0%</div>
                        <p id="successInfo">Hesaplanıyor...</p>
                    </div>
                    
                    <div class="stat-card">
                        <h5><i class="fas fa-trophy"></i> En İyi Emir</h5>
                        <div class="stat-value positive" id="bestOrder">$0.00</div>
                        <p id="bestOrderSymbol">-</p>
                    </div>
                </div>
                
                <!-- Tablo Kontrolleri -->
                <div class="table-controls">
                    <div>
                        <h3 style="margin: 0; color: #4a5568;">Gerçek Zamanlı Emir Verileri</h3>
                        <p class="last-update" id="lastUpdate">Son güncelleme: Yükleniyor...</p>
                    </div>
                    <div class="button-group">
                        <button id="refreshBtn" class="btn btn-primary refresh-btn">
                            <i class="fas fa-sync-alt"></i> Verileri Yenile
                        </button>
                        <button class="btn btn-success export-btn" onclick="exportData()">
                            <i class="fas fa-download"></i> CSV İndir
                        </button>
                        <button class="btn btn-secondary" onclick="printTable()">
                            <i class="fas fa-print"></i> Yazdır
                        </button>
                    </div>
                </div>
                
                <!-- Filtre Kontrolleri -->
                <div class="filter-controls">
                    <select id="statusFilter" class="form-select form-select-sm" style="max-width: 200px;">
                        <option value="">Tüm Durumlar</option>
                        <option value="Açık">Açık</option>
                        <option value="Kapalı">Kapalı</option>
                        <option value="Hedefe Ulaşıldı">Hedefe Ulaşıldı</option>
                        <option value="Zarar Durdur">Zarar Durdur</option>
                    </select>
                    
                    <select id="typeFilter" class="form-select form-select-sm" style="max-width: 200px;">
                        <option value="">Tüm Türler</option>
                        <option value="AL">AL</option>
                        <option value="SAT">SAT</option>
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select>
                    
                    <input type="text" id="symbolFilter" class="form-control form-control-sm" placeholder="Sembol Ara..." style="max-width: 200px;">
                    
                    <input type="date" id="dateFilter" class="form-control form-control-sm" style="max-width: 200px;" value="2025-12-19" readonly>
                </div>
                
                <!-- Tablo Container -->
                <div class="table-container">
                    <div id="loading" class="loading">
                        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                            <span class="visually-hidden">Yükleniyor...</span>
                        </div>
                        <p class="mt-3 pulse">Emir verileri GitHub Pages'ten yükleniyor...</p>
                        <small class="text-muted">19 Aralık 2025 tarihine ait veriler filtreleniyor</small>
                    </div>
                    
                    <div id="errorMessage" class="error-message" style="display: none;">
                        <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                        <h4>Veriler Yüklenemedi</h4>
                        <p id="errorText">API'ye bağlanırken bir hata oluştu. Lütfen daha sonra tekrar deneyin.</p>
                        <button id="retryBtn" class="btn btn-outline-danger mt-2">
                            <i class="fas fa-redo"></i> Tekrar Dene
                        </button>
                        <button onclick="window.location.reload()" class="btn btn-outline-primary mt-2 ms-2">
                            <i class="fas fa-sync"></i> Sayfayı Yenile
                        </button>
                    </div>
                    
                    <div class="table-responsive">
                        <table id="emirlerTable" class="table table-striped table-hover" style="display: none;">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Tarih/Saat</th>
                                    <th>Sembol</th>
                                    <th>Tür</th>
                                    <th>Lot</th>
                                    <th>Giriş Fiyatı</th>
                                    <th>Stop Loss</th>
                                    <th>Take Profit</th>
                                    <th>Kapanış Fiyatı</th>
                                    <th>Durum</th>
                                    <th>Açıklama</th>
                                    <th>Kar/Zarar</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                                <!-- Veriler JavaScript ile buraya eklenecek -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Analiz Bölümü -->
                <div class="info-box mt-4">
                    <h4><i class="fas fa-lightbulb"></i> Günün Analizi</h4>
                    <p>19 Aralık 2025'te piyasalar olumlu bir seyir izledi. EURUSD ve GBPUSD paritelerinde güçlü trendler yakalandı.</p>
                    <ul>
                        <li><strong>Veri Kaynağı:</strong> GitHub Actions → Local API → GitHub Pages</li>
                        <li><strong>Güncelleme Sıklığı:</strong> Her 5 dakikada bir</li>
                        <li><strong>Filtre:</strong> Sadece 19 Aralık 2025 tarihli emirler gösteriliyor</li>
                        <li><strong>Cache:</strong> Çevrimdışı durumda cache verileri kullanılır</li>
                    </ul>
                </div>
                
                <!-- Navigasyon Butonları -->
                <div class="table-controls mt-4">
                    <div class="button-group">
                        <a href="index.html" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Ana Sayfaya Dön
                        </a>
                        <button onclick="window.print()" class="btn btn-secondary">
                            <i class="fas fa-print"></i> Raporu Yazdır
                        </button>
                        <button onclick="exportData()" class="btn btn-success">
                            <i class="fas fa-download"></i> CSV İndir
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Sistem Bilgisi -->
            <div class="info-box mt-4">
                <h4><i class="fas fa-info-circle"></i> Sistem Bilgisi</h4>
                <p>Bu rapor GitHub Pages üzerinden sunulmaktadır.</p>
                <p>• <span class="positive">Yeşil</span> renk AL emirlerini veya kar durumunu gösterir</p>
                <p>• <span class="negative">Kırmızı</span> renk SAT emirlerini veya zarar durumunu gösterir</p>
                <p>• Veriler otomatik olarak güncellenir</p>
                <p>• HTTPS güvenli bağlantı kullanılır</p>
                <p>• <strong>GitHub Pages JSON:</strong> <a href="https://cagatay-a.github.io/TrueSignals/api-data.json" target="_blank">/api-data.json</a></p>
            </div>
        </main>
        
        <!-- FOOTER -->
        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h4>TrueSignal Emir Takip</h4>
                    <p>GitHub Pages + GitHub Actions + Local API</p>
                    <p>Gerçek Zamanlı Veri Senkronizasyonu</p>
                </div>
                
                <div class="footer-section">
                    <h4>Sayfalar</h4>
                    <ul>
                        <li><a href="index.html">Ana Sayfa</a></li>
                        <li><a href="about.html">Hakkında</a></li>
                        <li><a href="contact.html">İletişim</a></li>
                        <li><a href="404.html">404 Test</a></li>
                        <li><a href="2025-12-19.html">19 Aralık 2025</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>GitHub</h4>
                    <p>
                        <a href="https://github.com/cagatay-a/TrueSignals" style="color: #cbd5e0;">
                            <i class="fab fa-github"></i> cagatay-a/TrueSignals
                        </a>
                    </p>
                    <p>
                        <a href="https://github.com/cagatay-a/TrueSignals/actions" style="color: #cbd5e0;">
                            <i class="fas fa-play-circle"></i> GitHub Actions
                        </a>
                    </p>
                    <p style="font-size: 0.9rem; color: #a0aec0; margin-top: 10px;">
                        <i class="fas fa-code-branch"></i> JSON API: /api-data.json
                    </p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>© 2024 TrueSignal - GitHub Pages Emir Takip Sistemi</p>
                <p style="font-size: 0.8rem; color: #a0aec0; margin-top: 5px;">
                    <i class="fas fa-sync-alt"></i> Son Güncelleme: <span id="footerUpdateTime">-</span>
                    | <i class="fas fa-wifi"></i> Durum: <span id="connectionStatus">Çevrimiçi</span>
                    | <i class="fas fa-database"></i> Cache: <span id="cacheStatus">Aktif</span>
                </p>
            </div>
        </footer>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // CONFIGURATION - Bu tarihe özel
        const CURRENT_DATE = '2025-12-19';
        const GITHUB_PAGES_URL = "https://cagatay-a.github.io/TrueSignals/api-data.json";
        
        let emirListesi = [];
        let filteredEmirListesi = [];
        
        // Network status kontrolü
        function updateNetworkStatus() {
            const connectionStatus = document.getElementById('connectionStatus');
            
            if (navigator.onLine) {
                if (connectionStatus) {
                    connectionStatus.textContent = 'Çevrimiçi';
                    connectionStatus.style.color = '#38a169';
                }
            } else {
                if (connectionStatus) {
                    connectionStatus.textContent = 'Çevrimdışı';
                    connectionStatus.style.color = '#e53e3e';
                }
            }
        }
        
        // Footer güncelleme zamanı
        function updateFooterTime() {
            const now = new Date();
            const footerTimeElement = document.getElementById('footerUpdateTime');
            if (footerTimeElement) {
                footerTimeElement.textContent = 
                    now.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            }
        }
        
        // Cache durumu güncelleme
        function updateCacheStatus() {
            const cacheStatusElement = document.getElementById('cacheStatus');
            if (cacheStatusElement) {
                try {
                    const cacheTime = localStorage.getItem('truesignal_cache_time');
                    if (cacheTime) {
                        const cacheDate = new Date(parseInt(cacheTime));
                        const now = new Date();
                        const diffMinutes = Math.floor((now - cacheDate) / (1000 * 60));
                        
                        if (diffMinutes < 30) {
                            cacheStatusElement.textContent = `${diffMinutes} dk önce`;
                            cacheStatusElement.style.color = '#38a169';
                        } else {
                            cacheStatusElement.textContent = 'Eski';
                            cacheStatusElement.style.color = '#e53e3e';
                        }
                    } else {
                        cacheStatusElement.textContent = 'Yok';
                        cacheStatusElement.style.color = '#718096';
                    }
                } catch (e) {
                    cacheStatusElement.textContent = 'Hata';
                    cacheStatusElement.style.color = '#e53e3e';
                }
            }
        }
        
        // GitHub Pages'ten veri çek
        async function loadDataFromGitHub() {
            try {
                showLoading(true);
                
                const cacheBuster = '?t=' + Date.now();
                console.log('[FETCH] GitHub Pages:', GITHUB_PAGES_URL + cacheBuster);
                
                const response = await fetch(GITHUB_PAGES_URL + cacheBuster, {
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    },
                    cache: 'no-store'
                });
                
                if (!response.ok) {
                    throw new Error(`GitHub Pages HTTP hatası: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('[FETCH SUCCESS] GitHub Pages verisi alındı');
                
                // Veriyi işle
                processData(data);
                
            } catch (error) {
                console.error('[FETCH ERROR] GitHub Pages:', error.message);
                
                // Cache'den yükle
                if (!loadFromCache()) {
                    showError("GitHub Pages verisi şu anda yüklenemiyor. Lütfen sayfayı yenileyin (Ctrl+F5).");
                }
            } finally {
                showLoading(false);
            }
        }
        
        // Veri işleme
        function processData(data) {
            console.log('[PROCESS] Veri işleniyor...');
            
            let processedData = [];
            
            // VERİ YAPISI ANALİZİ
            if (data.success === true) {
                // Durum 1: İç içe yapı {emirler: {emirler: [...], success: true}}
                if (data.emirler && data.emirler.emirler && Array.isArray(data.emirler.emirler)) {
                    processedData = data.emirler.emirler;
                }
                // Durum 2: Düz yapı {emirler: [...], success: true}
                else if (data.emirler && Array.isArray(data.emirler)) {
                    processedData = data.emirler;
                }
            }
            
            // 19 Aralık 2025 tarihine göre filtrele
            filteredEmirListesi = processedData.filter(emir => {
                if (!emir.FormatliEmirZamani && !emir.EmirZamani) return false;
                
                const tarihStr = emir.FormatliEmirZamani || emir.EmirZamani;
                return tarihStr.includes(CURRENT_DATE);
            });
            
            console.log(`[FILTER] ${filteredEmirListesi.length} emir 19 Aralık 2025 için filtrelendi`);
            
            // Update global list
            emirListesi = processedData;
            
            // Cache'e kaydet
            cacheData(processedData);
            
            // Update UI
            updateTable();
            updateStats();
            updateLastUpdate(data.lastFetch || new Date().toISOString(), data.source || 'github-pages', true);
            
            // Filtre uygula
            applyFilters();
        }
        
        // Tablo güncelleme
        function updateTable() {
            const tbody = document.getElementById('tableBody');
            if (!tbody) return;
            
            if (filteredEmirListesi.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="13" style="text-align: center; padding: 50px;">
                            <i class="fas fa-calendar-times fa-3x mb-3" style="color: #cbd5e0;"></i>
                            <h4>19 Aralık 2025 tarihli emir bulunamadı</h4>
                            <p>Bu tarihe ait emir verisi henüz yüklenmemiş olabilir.</p>
                            <button class="btn btn-primary mt-3" onclick="loadDataFromGitHub()">
                                <i class="fas fa-sync-alt"></i> Yenile
                            </button>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredEmirListesi.forEach((emir, index) => {
                const sembol = emir.Sembol || 'N/A';
                const tip = emir.Tip || 'N/A';
                const durum = emir.Status || 'N/A';
                const lot = emir.Lot || '0';
                const giris = emir.GirisFiyati || '0';
                const stopLoss = emir.StopLoss;
                const takeProfit = emir.TakeProfit;
                const kapanis = emir.KapanisFiyati || '0';
                const karZarar = parseFloat(emir.KarZarar) || 0;
                const karZararYuzde = parseFloat(emir.KarZararYuzde) || 0;
                const tarih = emir.FormatliEmirZamani || emir.EmirZamani || 'N/A';
                const comment = emir.Comment || '-';
                
                // Durum badge
                let statusBadge = '';
                const durumLower = durum.toLowerCase();
                if (durumLower.includes('açık') || durumLower.includes('open')) {
                    statusBadge = `<span class="badge bg-warning">${durum}</span>`;
                } else if (durumLower.includes('kapalı') || durumLower.includes('closed')) {
                    statusBadge = `<span class="badge bg-success">${durum}</span>`;
                } else if (durumLower.includes('ulaşıldı')) {
                    statusBadge = `<span class="badge bg-info">${durum}</span>`;
                } else {
                    statusBadge = `<span class="badge bg-secondary">${durum}</span>`;
                }
                
                // Kar/Zarar renk sınıfı
                const karZararClass = karZarar >= 0 ? 'positive' : 'negative';
                const karZararText = karZarar >= 0 ? `+$${formatNumber(karZarar, 2)}` : `-$${formatNumber(Math.abs(karZarar), 2)}`;
                const karZararYuzdeText = karZararYuzde >= 0 ? `+${formatNumber(karZararYuzde, 2)}%` : `${formatNumber(karZararYuzde, 2)}%`;
                
                // Emir tipi renk
                const tipClass = tip.toLowerCase().includes('al') ? 'positive' : 'negative';
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${formatDateTime(tarih)}</td>
                        <td><strong>${sembol}</strong></td>
                        <td><span class="${tipClass}">${tip}</span></td>
                        <td>${formatNumber(lot)}</td>
                        <td>${formatNumber(giris, 4)}</td>
                        <td>${stopLoss ? formatNumber(stopLoss, 4) : '-'}</td>
                        <td>${takeProfit ? formatNumber(takeProfit, 4) : '-'}</td>
                        <td>${formatNumber(kapanis, 4)}</td>
                        <td>${statusBadge}</td>
                        <td>${comment}</td>
                        <td class="${karZararClass}">
                            ${karZararText}<br>
                            <small>${karZararYuzdeText}</small>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewDetails(${index})" title="Detaylar">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
            console.log(`[TABLE] ${filteredEmirListesi.length} satır güncellendi`);
            
            // Tabloyu göster
            showTable();
        }
        
        // İstatistik güncelleme
        function updateStats() {
            const total = filteredEmirListesi.length;
            const open = filteredEmirListesi.filter(e => {
                const durum = (e.Status || '').toLowerCase();
                return durum.includes('açık') || durum.includes('open');
            }).length;
            const closed = total - open;
            
            const totalProfit = filteredEmirListesi.reduce((sum, emir) => sum + (parseFloat(emir.KarZarar) || 0), 0);
            
            // Başarı oranı (sadece kapalı emirler için)
            const closedOrders = filteredEmirListesi.filter(e => {
                const durum = (e.Status || '').toLowerCase();
                return durum.includes('kapalı') || durum.includes('closed');
            });
            
            const successfulOrders = closedOrders.filter(e => (parseFloat(e.KarZarar) || 0) > 0).length;
            const successRate = closedOrders.length > 0 ? Math.round((successfulOrders / closedOrders.length) * 100) : 0;
            
            // En iyi emir
            let bestOrder = 0;
            let bestOrderSymbol = '-';
            filteredEmirListesi.forEach(emir => {
                const profit = parseFloat(emir.KarZarar) || 0;
                if (profit > bestOrder) {
                    bestOrder = profit;
                    bestOrderSymbol = emir.Sembol || '-';
                }
            });
            
            // Elementleri güncelle
            document.getElementById('totalOrders').textContent = total;
            document.getElementById('openClosedInfo').textContent = `Açık: ${open} | Kapalı: ${closed}`;
            
            const totalProfitElement = document.getElementById('totalProfitLoss');
            totalProfitElement.textContent = totalProfit >= 0 ? `+$${formatNumber(totalProfit, 2)}` : `-$${formatNumber(Math.abs(totalProfit), 2)}`;
            totalProfitElement.className = totalProfit >= 0 ? 'stat-value positive' : 'stat-value negative';
            
            document.getElementById('successRate').textContent = `${successRate}%`;
            document.getElementById('successInfo').textContent = closedOrders.length > 0 ? `${successfulOrders}/${closedOrders.length} Başarılı` : 'Kapalı emir yok';
            
            const bestOrderElement = document.getElementById('bestOrder');
            bestOrderElement.textContent = bestOrder > 0 ? `+$${formatNumber(bestOrder, 2)}` : '-';
            document.getElementById('bestOrderSymbol').textContent = bestOrderSymbol;
        }
        
        // Son güncelleme zamanı
        function updateLastUpdate(timestamp, source, success) {
            const element = document.getElementById('lastUpdate');
            if (!element) return;
            
            try {
                const date = new Date(timestamp);
                const timeStr = date.toLocaleTimeString('tr-TR');
                const dateStr = date.toLocaleDateString('tr-TR');
                
                element.innerHTML = `
                    <i class="fas ${success ? 'fa-check-circle' : 'fa-exclamation-triangle'}" style="color: ${success ? '#38a169' : '#e53e3e'}"></i>
                    <span>Son güncelleme: ${timeStr} (${dateStr})</span>
                    <small class="text-muted"> | ${filteredEmirListesi.length} emir filtrelendi</small>
                `;
            } catch (error) {
                element.innerHTML = `
                    <i class="fas fa-clock"></i>
                    <span>Son güncelleme: ${new Date().toLocaleTimeString('tr-TR')}</span>
                `;
            }
        }
        
        // 19 Aralık 2025 için özel filtreleme
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter')?.value || '';
            const typeFilter = document.getElementById('typeFilter')?.value || '';
            const symbolFilter = document.getElementById('symbolFilter')?.value.toLowerCase() || '';
            
            const rows = document.querySelectorAll('#emirlerTable tbody tr');
            let visibleCount = 0;
            
            rows.forEach(row => {
                if (row.cells.length < 13) return; // Boş satır kontrolü
                
                const status = row.cells[9]?.textContent || '';
                const type = row.cells[3]?.textContent || '';
                const symbol = row.cells[2]?.textContent?.toLowerCase() || '';
                
                let show = true;
                
                if (statusFilter && !status.includes(statusFilter)) {
                    show = false;
                }
                
                if (typeFilter && type !== typeFilter) {
                    show = false;
                }
                
                if (symbolFilter && !symbol.includes(symbolFilter)) {
                    show = false;
                }
                
                row.style.display = show ? '' : 'none';
                if (show) visibleCount++;
            });
            
            // Filtre sonucunu göster
            const tableTitle = document.querySelector('.table-title');
            if (tableTitle && rows.length > 0) {
                tableTitle.innerHTML = `<i class="fas fa-table"></i> 19 Aralık 2025 Emirleri (${visibleCount}/${filteredEmirListesi.length})`;
            }
            
            // İstatistikleri güncelle
            updateStats();
        }
        
        // Cache fonksiyonları
        function cacheData(data) {
            try {
                const cache = {
                    data: data,
                    timestamp: Date.now(),
                    count: data.length
                };
                localStorage.setItem('truesignal_cache', JSON.stringify(cache));
                localStorage.setItem('truesignal_cache_time', Date.now().toString());
                console.log(`[CACHE] ${data.length} emir cache'e kaydedildi`);
            } catch (error) {
                console.warn('[CACHE] Kaydedilemedi:', error);
            }
        }
        
        function loadFromCache() {
            try {
                const cached = localStorage.getItem('truesignal_cache');
                if (!cached) return false;
                
                const cache = JSON.parse(cached);
                const cacheAge = Date.now() - cache.timestamp;
                
                if (cacheAge < (30 * 60 * 1000) && cache.data && cache.data.length > 0) {
                    console.log(`[CACHE] ${cache.data.length} emir cache'den yüklendi (${Math.round(cacheAge/1000)}s önce)`);
                    
                    // Cache'den yükle ve filtrele
                    emirListesi = cache.data;
                    filteredEmirListesi = cache.data.filter(emir => {
                        if (!emir.FormatliEmirZamani && !emir.EmirZamani) return false;
                        const tarihStr = emir.FormatliEmirZamani || emir.EmirZamani;
                        return tarihStr.includes(CURRENT_DATE);
                    });
                    
                    updateTable();
                    updateStats();
                    
                    const element = document.getElementById('lastUpdate');
                    if (element) {
                        const time = new Date(cache.timestamp);
                        element.innerHTML = `
                            <i class="fas fa-database"></i>
                            <span>Cache'den: ${time.toLocaleTimeString('tr-TR')}</span>
                            <small class="text-muted">(${Math.round(cacheAge / 1000)} saniye önce)</small>
                        `;
                    }
                    
                    showTable();
                    return true;
                }
            } catch (error) {
                console.error('[CACHE ERROR]:', error);
            }
            return false;
        }
        
        // UI Fonksiyonları
        function showLoading(show) {
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            
            if (loading) loading.style.display = show ? 'flex' : 'none';
            if (errorMessage && !show) errorMessage.style.display = 'none';
        }
        
        function showTable() {
            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            const table = document.getElementById('emirlerTable');
            
            if (loading) loading.style.display = 'none';
            if (errorMessage) errorMessage.style.display = 'none';
            if (table) table.style.display = 'table';
        }
        
        function showError(message) {
            const error = document.getElementById('errorMessage');
            const errorText = error ? error.querySelector('#errorText') : null;
            
            if (error) {
                error.style.display = 'block';
                if (errorText) errorText.textContent = message;
            }
            
            const table = document.getElementById('emirlerTable');
            if (table) table.style.display = 'none';
            
            showLoading(false);
        }
        
        // Yardımcı fonksiyonlar
        function formatNumber(value, decimals = 2) {
            if (value === null || value === undefined || value === '' || value === '-') return '-';
            const num = parseFloat(value);
            return isNaN(num) ? value : num.toFixed(decimals);
        }
        
        function formatDateTime(datetimeStr) {
            if (!datetimeStr) return '-';
            try {
                // 19 Aralık 2025 formatına uygun hale getir
                if (datetimeStr.includes(CURRENT_DATE)) {
                    const parts = datetimeStr.split(' ');
                    if (parts.length >= 2) {
                        return `${parts[0]} ${parts[1]}`;
                    }
                }
                return datetimeStr;
            } catch (error) {
                return datetimeStr;
            }
        }
        
        // Export data function
        function exportData() {
            const table = document.getElementById('emirlerTable');
            if (!table) {
                alert('Tabloya ulaşılamadı!');
                return;
            }
            
            // Sadece görünen satırları al
            const visibleRows = [];
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                if (row.style.display !== 'none') {
                    visibleRows.push(row);
                }
            });
            
            if (visibleRows.length === 0) {
                alert('Görüntülenecek emir bulunamadı!');
                return;
            }
            
            let csv = [];
            
            // Başlık satırı
            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                headers.push(`"${th.innerText.replace(/(\r\n|\n|\r)/gm, "").replace(/\s+/g, " ")}"`);
            });
            csv.push(headers.join(","));
            
            // Veri satırları
            visibleRows.forEach(row => {
                let rowData = [];
                row.querySelectorAll('td').forEach(td => {
                    let text = td.innerText.replace(/(\r\n|\n|\r)/gm, "").replace(/\s+/g, " ");
                    rowData.push(`"${text}"`);
                });
                csv.push(rowData.join(","));
            });
            
            const csvContent = csv.join("\n");
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `truesignal_${CURRENT_DATE}_emirler_${new Date().getHours()}${new Date().getMinutes()}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert('Tarayıcınız CSV indirmeyi desteklemiyor!');
            }
        }
        
        // Print function
        function printTable() {
            window.print();
        }
        
        // Detay görüntüleme
        function viewDetails(index) {
            if (index >= 0 && index < filteredEmirListesi.length) {
                const emir = filteredEmirListesi[index];
                const details = `
Emir Detayları (19 Aralık 2025):
─────────────────────────────
Sembol: ${emir.Sembol || 'N/A'}
Tip: ${emir.Tip || 'N/A'}
Durum: ${emir.Status || 'N/A'}
Lot: ${formatNumber(emir.Lot)}
Giriş Fiyatı: ${formatNumber(emir.GirisFiyati, 4)}
Kapanış Fiyatı: ${formatNumber(emir.KapanisFiyati, 4)}
Stop Loss: ${emir.StopLoss || 'Yok'}
Take Profit: ${emir.TakeProfit || 'Yok'}
Kar/Zarar: ${formatNumber(emir.KarZarar, 2)} (${formatNumber(emir.KarZararYuzde, 2)}%)
Emir Zamanı: ${formatDateTime(emir.FormatliEmirZamani || emir.EmirZamani)}
Kapanış Zamanı: ${formatDateTime(emir.FormatliKapanisZamani || emir.KapanisZamani)}
Not: ${emir.Comment || 'Yok'}
─────────────────────────────
                `;
                alert(details);
            }
        }
        
        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', function() {
            updateNetworkStatus();
            updateFooterTime();
            updateCacheStatus();
            
            // Her dakika footer zamanını güncelle
            setInterval(updateFooterTime, 60000);
            setInterval(updateCacheStatus, 30000);
            
            // Network durumunu dinle
            window.addEventListener('online', updateNetworkStatus);
            window.addEventListener('offline', updateNetworkStatus);
            
            console.log('TrueSignal - 19 Aralık 2025 Günlük Raporu yüklendi');
            
            // Önce cache'den yükle
            const cacheLoaded = loadFromCache();
            
            // Hemen API'den yükle
            setTimeout(() => {
                loadDataFromGitHub();
            }, cacheLoaded ? 1000 : 0);
            
            // Filtre event listener'ları
            const statusFilter = document.getElementById('statusFilter');
            const typeFilter = document.getElementById('typeFilter');
            const symbolFilter = document.getElementById('symbolFilter');
            
            if (statusFilter) statusFilter.addEventListener('change', applyFilters);
            if (typeFilter) typeFilter.addEventListener('change', applyFilters);
            if (symbolFilter) symbolFilter.addEventListener('input', applyFilters);
            
            // Refresh butonu
            const refreshBtn = document.getElementById('refreshBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Yenileniyor...';
                    this.disabled = true;
                    
                    loadDataFromGitHub().finally(() => {
                        setTimeout(() => {
                            this.innerHTML = '<i class="fas fa-sync-alt"></i> Verileri Yenile';
                            this.disabled = false;
                        }, 1000);
                    });
                });
            }
            
            // Retry butonu
            const retryBtn = document.getElementById('retryBtn');
            if (retryBtn) {
                retryBtn.addEventListener('click', function() {
                    loadDataFromGitHub();
                });
            }
        });
        
        // Global fonksiyonlar
        window.exportData = exportData;
        window.printTable = printTable;
        window.applyFilters = applyFilters;
        window.viewDetails = viewDetails;
        window.loadDataFromGitHub = loadDataFromGitHub;
    </script>
</body>
</html>